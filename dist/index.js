(()=>{const a="/audiogata",e="/nowplaying.json",t="/plugins.json",s="/playlists.json";let o;const n=a=>{application.postUiMessage(a)},c=a=>{o=new Dropbox.DropboxAuth({clientId:a||"dz4gaw4bayoft8a"})},i=(a,e)=>{o.setAccessToken(a),o.setRefreshToken(e),application.onNowPlayingTracksAdded=r,application.onNowPlayingTracksChanged=r,application.onNowPlayingTracksRemoved=r,application.onNowPlayingTracksSet=r},l=async(e,t)=>{const s=new Dropbox.Dropbox({auth:o});await s.filesUpload({path:a+e,mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(t)})},p=async e=>{const t=new Dropbox.Dropbox({auth:o}),s=(await t.filesDownload({path:a+e})).result.fileBlob,n=await s.text();return JSON.parse(n)},r=async()=>{const a=await application.getNowPlayingTracks();await l(e,a),n({type:"message",message:"Successfully saved Now playing tracks."})};application.onUiMessage=async a=>{switch(a.type){case"login":let o=a.accessToken,g=a.refreshToken;localStorage.setItem("access_token",o),localStorage.setItem("refresh_token",g),i(o,g);break;case"check-login":const y=localStorage.getItem("access_token");y&&n({type:"login",accessToken:y}),await(async()=>{const a=document.location.host.split(".");a.shift();const e=a.join("."),t=`${document.location.protocol}//${e}`,s=await application.getPluginId(),o=localStorage.getItem("clientId")??"";n({type:"info",origin:t,pluginId:s,clientId:o})})();break;case"save":await r();break;case"load":await(async()=>{const a=await p(e);await application.setNowPlayingTracks(a),n({type:"message",message:"Successfully loaded Now playing tracks."})})();break;case"save-plugins":await(async()=>{const a=await application.getPlugins();await l(t,a),n({type:"message",message:"Successfully saved plugins."})})();break;case"load-plugins":await(async()=>{const a=await p(t);application.installPlugins(a)})();break;case"save-playlists":await(async()=>{const a=await application.getPlaylists();await l(s,a),n({type:"message",message:"Successfully saved playlists."})})();break;case"load-playlists":await(async()=>{const a=await p(s);await application.addPlaylists(a),n({type:"message",message:"Successfully added playlists."})})();break;case"set-keys":localStorage.setItem("clientId",a.clientId),c(a.clientId);break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}},application.onDeepLinkMessage=async a=>{application.postUiMessage({type:"deeplink",url:a})};(async()=>{await new Promise(((a,e)=>{const t=document.createElement("script");t.src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t),t.onload=()=>{a()},t.onerror=()=>{e()}}));const a=localStorage.getItem("clientId");c(a);let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");e&&t&&i(e,t)})()})();