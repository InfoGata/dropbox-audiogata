(()=>{const a="/audiogata",e="/nowplaying.json",o="/plugins.json";let t;const n=(a,e)=>{t.setAccessToken(a),t.setRefreshToken(e),application.onNowPlayingTracksAdded=c,application.onNowPlayingTracksChanged=c,application.onNowPlayingTracksRemoved=c,application.onNowPlayingTracksSet=c},s=async(e,o)=>{const n=new Dropbox.Dropbox({auth:t});await n.filesUpload({path:a+e,mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(o)})},i=async e=>{const o=new Dropbox.Dropbox({auth:t}),n=(await o.filesDownload({path:a+e})).result.fileBlob,s=await n.text();return JSON.parse(s)},c=async()=>{const a=await application.getNowPlayingTracks();await s(e,a)};application.onUiMessage=async a=>{switch(a.type){case"login":let t=a.accessToken,l=a.refreshToken;localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",l),n(t,l);break;case"check-login":const p=localStorage.getItem("access_token");p&&await application.postUiMessage({type:"login",accessToken:p}),(()=>{const a=document.location.host,e=a.split(".")[0],o=a.split(".");o.shift();const t=o.join("."),n=`${document.location.protocol}//${t}`;application.postUiMessage({type:"origin",origin:n,pluginId:e})})();break;case"save":await c();break;case"load":await(async()=>{const a=await i(e);await application.setNowPlayingTracks(a)})();break;case"save-plugins":await(async()=>{const a=await application.getPlugins();await s(o,a)})();break;case"load-plugins":await(async()=>{const a=await i(o);application.installPlugins(a)})();break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}},application.onDeepLinkMessage=async a=>{console.log(a),application.postUiMessage({type:"deeplink",url:a})};(async()=>{await new Promise(((a,e)=>{const o=document.createElement("script");o.src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",o.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(o),o.onload=()=>{a()},o.onerror=()=>{e()}})),t=new Dropbox.DropboxAuth({clientId:"dz4gaw4bayoft8a"});let a=localStorage.getItem("access_token"),e=localStorage.getItem("refresh_token");a&&e&&n(a,e)})()})();