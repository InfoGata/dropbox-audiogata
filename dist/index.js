const m="a5kcn574s1k88k5",r="/nowplaying.json",g="/plugins.json",d="/playlists.json";let n;const o=e=>{application.postUiMessage(e)},y=e=>{n=new Dropbox.DropboxAuth({clientId:e||m})},k=(e,t)=>{n.setAccessToken(e),n.setRefreshToken(t)},l=async(e,t)=>{await new Dropbox.Dropbox({auth:n}).filesUpload({path:e,mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(t)})},i=async e=>{const c=await(await new Dropbox.Dropbox({auth:n}).filesDownload({path:e})).result.fileBlob.text();return JSON.parse(c)},w=async()=>{const e=await application.getNowPlayingTracks();await l(r,e),o({type:"message",message:"Successfully saved Now playing tracks."})},h=async()=>{const e=await i(r);await application.setNowPlayingTracks(e),o({type:"message",message:"Successfully loaded Now playing tracks."})},b=async()=>{const e=await application.getPlugins();await l(g,e),o({type:"message",message:"Successfully saved plugins."})},I=async()=>{const e=await i(d);await application.addPlaylists(e),o({type:"message",message:"Successfully added playlists."})},f=async()=>{const e=await application.getPlaylists();await l(d,e),o({type:"message",message:"Successfully saved playlists."})},T=async()=>{const e=await i(g);application.installPlugins(e)},P=async()=>{const t=document.location.host.split(".");t.shift();const a=t.join("."),s=`${document.location.protocol}//${a}`,c=await application.getPluginId(),p=localStorage.getItem("clientId")??"";o({type:"info",origin:s,pluginId:c,clientId:p})};application.onUiMessage=async e=>{switch(e.type){case"login":let t=e.accessToken,a=e.refreshToken;localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",a),k(t,a);break;case"check-login":const s=localStorage.getItem("access_token");s&&o({type:"login",accessToken:s}),await P();break;case"save":await w();break;case"load":await h();break;case"save-plugins":await b();break;case"load-plugins":await T();break;case"save-playlists":await f();break;case"load-playlists":await I();break;case"set-keys":localStorage.setItem("clientId",e.clientId),y(e.clientId);break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token");break}};application.onDeepLinkMessage=async e=>{application.postUiMessage({type:"deeplink",url:e})};const S=()=>new Promise((e,t)=>{const a="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",s=document.createElement("script");s.src=a,s.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(s),s.onload=()=>{e()},s.onerror=()=>{t()}}),u=e=>{localStorage.setItem("vite-ui-theme",e)};application.onChangeTheme=async e=>{u(e)};const v=async()=>{await S();const e=localStorage.getItem("clientId");y(e);let t=localStorage.getItem("access_token"),a=localStorage.getItem("refresh_token");t&&a&&k(t,a);const s=await application.getTheme();u(s)};v();
