(()=>{let e,a="",o="";const t=(a,o)=>{e.setAccessToken(a),e.setRefreshToken(o)};application.onUiMessage=async e=>{switch(e.type){case"login":a=e.accessToken,o=e.refreshToken,localStorage.setItem("access_token",a),localStorage.setItem("refresh_token",o),t(a,o);break;case"check-login":const c=localStorage.getItem("access_token");c&&await application.postUiMessage({type:"login",accessToken:c});break;case"save":await s();break;case"logout":localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token");break;case"load":await n()}};const s=async()=>{const a=new Dropbox.Dropbox({auth:e}),o=await application.getNowPlayingTracks();await a.filesUpload({path:"/audiogata/nowplaying.json",mute:!0,mode:{".tag":"overwrite"},contents:JSON.stringify(o)})},n=async()=>{const a=new Dropbox.Dropbox({auth:e}),o=(await a.filesDownload({path:"/audiogata/nowplaying.json"})).result.fileBlob,t=await o.text();console.log(t)};(async()=>{await new Promise(((e,a)=>{const o=document.createElement("script");o.src="https://unpkg.com/dropbox/dist/Dropbox-sdk.min.js",o.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(o),o.onload=()=>{e()},o.onerror=()=>{a()}})),e=new Dropbox.DropboxAuth({clientId:"dz4gaw4bayoft8a"}),a=localStorage.getItem("access_token"),o=localStorage.getItem("refresh_token"),a&&o&&t(a,o)})()})();